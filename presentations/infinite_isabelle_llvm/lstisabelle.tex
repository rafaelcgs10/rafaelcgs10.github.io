% Stolen from https://raw.githubusercontent.com/lammich/isabelle_llvm/2022/papers/ITP2022/lstisabelle.tex
% Not really meant for highlighting isabelle source, but for easily writing latex that looks like
% isabelle
%
% keyword level 1 - isabelle outer syntax
% keyword level 2 - isabelle inner syntax programming constructs (if, let, etc)
% keyword level 3 - standard constants (length, mod, etc)
% keyword level 4 - isabelle proof methods


% \newcommand{\lsem}{\ensuremath{\mathopen{[\![}}}
% \newcommand{\rsem}{\ensuremath{\mathclose{]\!]}}}

\lstdefinelanguage{isabelle}{
  morekeywords={theorem,theorems,corollary,lemma,lemmas,locale,sublocale,global_interpretation,begin,end,fixes,assumes,shows,and,class,
    constrains , definition, abbreviation, defines, where, done,unfolding, primrec, primcorec, inductive, coinductive, corecursive, corec, friend_of_corec, partial_function, fun, function, using, by, for, uses, file,
    schematic_lemma, concrete_definition, prepare_code_thms, export_code, datatype, codatatype, type_synonym, typedef, value,
    proof, next, qed, show, have, hence, thus, interpretation, fix, context, sepref_definition,is,export_llvm
 } ,
  morekeywords=[2]{rec, return, bind, foreach, if, then, else, do, let, in, res, spec, fail, assert, assume, while, case, of,
    check,with_split,npar,nseq},
  morekeywords=[3]{LNil, LCons, ltl, lhd, lnull, lmap, lset, Cons, None, Some, the, lfind, Logic, fold, produce, produce_inner, count_op, while_option, LEAST, ^^, snd, fst, produce_inner_aux, hd, tl,
    produce_1', produce_1, produce_induct, @, fproduce, comp_op, produce_comp_op_correctness, produce_1_comp_op_None_fproduce, skip_op, cong,
    ldropn, produce_1_comp_op_None_fproduce, WM, wmk, tmp, data, DT, insert, monotone, LConsR, LConsL, productive, EnvWM, EnvDT, LFinite, monotone_cong, monotone_cong_prepend, vimage, Suc,
    length, llength, set_t, tmps, drop, nth, coinduction, lfinite, llist_of, batch_op, filter, lfilter, incr_op, remdups, rev, map, List, map_filter, mset, case_event, Map, empty, lfilter, case_event, list_of,
    data_at, data_at_from_list, lcoll, coll, mono_prod, set, batch_coll_sound, get_Data, enat, ts, ws, batch_ts, lnth, batch_ts_sound, undefined, LNil_lprefix, LCons_lprefix, In_llist, Next_llist, in_llist,
    EZero, ESucc, ltake, pf_prod, pf_stop, pf_step, concat, snd, ltake_DT, the_enat, acc_batches, incr_batch_op, maxchain, paths, lpaths, incr_lcoll, incr_coll, sum, map_op, incr_hist_op,
    join_op, flatten_op, join_list, union_op, Inl, Inr, apply, Inl_leq, Inr_leq, incr_hist_op', eq_op, eq_op_lifted, WM, rel_prod, EQ, less_eq_sum, Pow, prefix, exit,
    monotone_cong_base, productive_cong, productive_cong_base, productive_cong_prepend, wms, lapp, lconcat, lprefix, lfilter, lshift, @@, lSup, THE},
%   morekeywords=[4]{simp,auto,intro,elim,rprems,refine_mono,refine_rcg},
  sensitive=True,
  morecomment=[s]{(\*}{\*)},
  moredelim=*[is][\ttfamily]{**}{**},
}


\DeclareTextCommand{\shortunderscore}{T1}{%
  \leavevmode \kern.06em\vbox{\hrule width.4em}}

\renewcommand{\textunderscore}{\shortunderscore}

\lstset{
    language=isabelle,
    upquote=true,
    mathescape=true,
    escapeinside={--"}{"},
    basicstyle={\itshape},
    keywordstyle=\rm\bfseries,
    keywordstyle=[2]\rm\tt,
    keywordstyle=[3]\rm\sffamily,
    keywordstyle=[4]\rm,
    keywordstyle=[5]\rm\bfseries,
    showstringspaces=false,
    keepspaces=true,
    columns=[c]fullflexible}
\lstset{literate=
  {"}{}0
%  {'}{{${}^\prime\!$}}1
  %{''}{{${}^\prime$}}1
  {'}{{${}^\prime$}}1
  {~:}{{$\notin$}}1
  {\%}{{$\lambda$}}1
  {\\\%}{{$\lambda$}}1
  {\\\$}{{$\mathbin{\,\$\,}$}}1
  {&}{{$\wedge$}}1
  {?}{{$\exists$}}1
%  {!}{{$\forall$}}1 clashes with nth xs!i
  {->}{{$\rightarrow$}}1
  {<-}{{$\leftarrow$}}1
%   {<.}{{$\langle$}}1
%   {.>}{{$\rangle$}}1
  {<=}{{$\le$}}1
  {>=}{{$\ge$}}1
  {<->}{{$\leftrightarrow$}}1
  {-->}{{$\longrightarrow$}}2
  {-->>}{{$\boldsymbol{\longrightarrow}$}}5
  {<-->}{{$\longleftrightarrow$}}1
  {=>}{{$\Rightarrow$}}1
  {==}{{$\equiv$}}2
  {==>}{{$\implies$}}2
  {<=>}{{$\Leftrightarrow$}}1
  {~=}{{$\ne$}}1
  {|}{{$\mid$}}1
  % {-`}{$vimage$}1
  {|`}{{$\restriction$}}1
  {!!}{{$\bigwedge$}}1
  {(}{{$($}}1
  {)}{{$)$}}1
  {\{}{{$\{$}}1
  {\}}{{$\}$}}1
  {[}{{$[$}}1
  {]}{{$]$}}1
  {[|}{{$\llbracket$}}1
  {|]}{{$\rrbracket$}}1
  {\\<lbrakk>}{{$\lsem$}}1
  {\\<rbrakk>}{{$\rsem$}}1
  {|-}{{$\vdash$}}1
  {|=}{{$\models$}}1
  {|->}{{$\mapsto$}}1
  {|_|}{{$\bigsqcup$}}1
  {...}{{$\dots$}}1
  {\\x}{{$\times$}}1
  {_0}{{${}_0$}}1
  {_1}{{${}_1$}}1
  {_2}{{${}_2$}}1
  {_3}{{${}_3$}}1
  {_4}{{${}_4$}}1
  {_5}{{${}_5$}}1
  {_6}{{${}_6$}}1
  {_7}{{${}_7$}}1
  {_8}{{${}_8$}}1
  {_9}{{${}_9$}}1
  {_L}{{${}_L$}}1
  {\\_n}{{${}_n$}}1
  {\\_i}{{${}_i$}}1
  {\\_j}{{${}_j$}}1
  {\\_x}{{${}_x$}}1
  {\\_y}{{${}_y$}}1
  {\\impl}{{${}_\dagger$}}1
  {^*}{{$^*$}}1
  {^k}{{$^k$}}1
  {^d}{{$^d$}}1
  {\\<^sup>*}{{$^*$}}1
  {\\<^sub>*}{{$_*$}}1
  {\\<^sub>A}{{$_A$}}1
  {\\<^sub>r}{{$_r$}}1
  {\\<^sub>a}{{$_a$}}1
  {:_i}{{$:_i$}}1
  {\\<A>}{{$\mathcal{A}$}}1
  {\\<O>}{{\sf o}}1
  {\\<Phi>}{{$\Phi$}}1
  {\\<phi>}{{$\phi$}}1
  {\\<Psi>}{{$\Psi$}}1
  {\\<sigma>}{{$\sigma$}}1
  {\\<Sigma>}{{$\Sigma$}}1
  {\\<cdot>}{{$\cdot$}}1
  {\\<in>}{{$\in$}}1
  {\\<le>}{{$\le$}}1
  {\\<noteq>}{{$\ne$}}1
  {\\<lambda>}{{$\lambda$}}1
  {\\<longrightarrow>}{{$\longrightarrow$}}1
  {\\<longleftrightarrow>}{{$\longleftrightarrow$}}1
  {\\<Rightarrow>}{{$\Rightarrow$}}1
  {\\<Longrightarrow>}{{$\Longrightarrow$}}1
  {\\<rightarrow>}{{$\rightarrow$}}1
  {\\<leftarrow>}{{$\leftarrow$}}1
  {\\<mapsto>}{{$\mapsto$}}1
  {\\<equiv>}{{$\equiv$}}1
  {\\<and>}{{$\wedge$}}1
  {\\<or>}{{$\vee$}}1
  {\\<And>}{{$\bigwedge$}}1
  {\\<Up>}{{$\Uparrow$}}1
  {\\<Down>}{{$\Downarrow$}}1
  {\\<Union>}{{$\bigcup$}}1
  {\\<up>}{{$\uparrow$}}1
  {\\<down>}{{$\downarrow$}}1
  {\\<times>}{{$\times$}}1
  {\\<forall>}{{$\forall$}}1
  {\\<exists>}{{$\exists$}}1
  {\\<nexists>}{{$\nexists$}}1
  {\\<union>}{{$\cup$}}1
  {\\<inter>}{{$\cap$}}1
  {\\in}{$\in$}1
  {\\union}{{$\cup$}}1
  {\\inter}{{$\cap$}}1
  {\\<subset>}{{$\subset$}}1
  {\\<subseteq>}{{$\subseteq$}}1
  {\\<supset>}{{$\supset$}}1
  {\\<supseteq>}{{$\supseteq$}}1
  {\\<alpha>}{{$\alpha$}}1
  {\\<beta>}{{$\beta$}}1
  {\\<gamma>}{{$\gamma$}}1
  {\\alpha}{{$\alpha$}}1
  {\\beta}{{$\beta$}}1
  {\\gamma}{{$\gamma$}}1
  {\\rho}{{$\rho$}}1
  {\\<rho>}{{$\rho$}}1
  {\\<Gamma>}{{$\Gamma$}}1
  {\\<langle>}{{$\langle$}}1
  {\\<rangle>}{{$\rangle$}}1
  {\\<not>}{{$\neg$}}1
  {\\<box>}{{$\oblong$}}1
  {\\<bot>}{{$\bot$}}1
  {\\<top>}{{$\top$}}1
  {\\<notin>}{{$\notin$}}1
  {\\<guillemotright>}{{$\gg$}}1
  {\\approx}{$\approx$}1
  {\\<approx>}{$\approx$}1
  {\\and}{$\wedge$}1
  {\\or}{$\vee$}1
  {\\mu}{$\mu$}1
  {\\Phi}{{$\Phi$}}1
  {\\Psi}{{$\Psi$}}1
  {\\le}{{$\le$}}1
  {\\Up}{{$\Uparrow$}}1
  {\\Down}{{$\Down$}}1
  {>>}{{$\gg$}}1
  {>>=}{{${\gg}{=}$}}1
  {<*lex*>}{{$\times_{\sf lex}$}}1
  {\\<open>}{{\rm\guilsinglleft}}1
  {\\<close>}{{\rm\guilsinglright}}1
  {\\<box>}{{$\square$}}1
  {\\<proof>}{{\color{darkgray}$\langle\text{proof}\rangle$}}7
}

\newcommand*{\rightcomment}[1]{\hfill\color{darkgray} --- #1}%

% \newcommand{\is}{\lstinline[language=isabelle,basicstyle=\normalsize\ttfamily\slshape]}
\newcommand{\is}{\lstinline[language=isabelle]}%, breaklines=true]}
\newcommand{\cs}{\lstinline[language=C++]}
\newcommand{\q}[1]{\mbox{\guilsinglleft{#1}\hspace{-.0pt}\guilsinglright}}
% \newcommand{\isai}[1]{\q{\lstinline[language=isabelle,basicstyle=\normalsize\ttfamily\slshape]{#1}}}
% \cMakeRobust
